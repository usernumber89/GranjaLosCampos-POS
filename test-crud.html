<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba CRUD POS - Firebase</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
        .success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        .info {
            background: #e3f2fd;
            color: #1565c0;
            border: 1px solid #2196f3;
        }
        button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .data {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Prueba CRUD del POS</h1>

        <div id="status" class="status info">Inicializando Firebase...</div>

        <!-- Agregar Registro -->
        <div class="test-section">
            <h3>‚ûï Agregar Registro</h3>
            <div class="form-group">
                <label for="tipo">Tipo:</label>
                <select id="tipo">
                    <option value="venta">Venta</option>
                    <option value="compra">Compra</option>
                    <option value="gasto">Gasto</option>
                </select>
            </div>
            <div class="form-group">
                <label for="descripcion">Descripci√≥n:</label>
                <input type="text" id="descripcion" placeholder="Ej: Venta de pollo">
            </div>
            <div class="form-group">
                <label for="cantidad">Cantidad:</label>
                <input type="number" id="cantidad" placeholder="1">
            </div>
            <div class="form-group">
                <label for="precio">Precio:</label>
                <input type="number" id="precio" step="0.01" placeholder="100.00">
            </div>
            <button onclick="testAgregarRegistro()">Agregar Registro</button>
        </div>

        <!-- Obtener Todos -->
        <div class="test-section">
            <h3>üìã Obtener Todos los Registros</h3>
            <button onclick="testObtenerTodos()">Obtener Todos</button>
            <div id="todos-data" class="data" style="display: none;"></div>
        </div>

        <!-- Buscar Registro -->
        <div class="test-section">
            <h3>üîç Buscar Registro por ID</h3>
            <div class="form-group">
                <label for="buscar-id">ID del Registro:</label>
                <input type="text" id="buscar-id" placeholder="Ingresa el ID">
            </div>
            <button onclick="testObtenerRegistro()">Buscar Registro</button>
            <div id="registro-data" class="data" style="display: none;"></div>
        </div>

        <!-- Actualizar Registro -->
        <div class="test-section">
            <h3>‚úèÔ∏è Actualizar Registro</h3>
            <div class="form-group">
                <label for="update-id">ID del Registro:</label>
                <input type="text" id="update-id" placeholder="ID a actualizar">
            </div>
            <div class="form-group">
                <label for="update-descripcion">Nueva Descripci√≥n:</label>
                <input type="text" id="update-descripcion" placeholder="Nueva descripci√≥n">
            </div>
            <button onclick="testActualizarRegistro()">Actualizar Registro</button>
        </div>

        <!-- Eliminar Registro -->
        <div class="test-section">
            <h3>üóëÔ∏è Eliminar Registro</h3>
            <div class="form-group">
                <label for="delete-id">ID del Registro:</label>
                <input type="text" id="delete-id" placeholder="ID a eliminar">
            </div>
            <button onclick="testEliminarRegistro()">Eliminar Registro</button>
        </div>

        <!-- Limpiar Store -->
        <div class="test-section">
            <h3>üßπ Limpiar Todos los Registros</h3>
            <button onclick="testLimpiarStore()" style="background: #f44336;">Limpiar Todo</button>
        </div>

        <div class="status info">
            <strong>üí° Consejos:</strong><br>
            ‚Ä¢ Agrega algunos registros primero<br>
            ‚Ä¢ Copia IDs de registros para buscar/actualizar/eliminar<br>
            ‚Ä¢ Usa "Obtener Todos" para ver todos los datos<br>
            ‚Ä¢ "Limpiar Todo" elimina TODOS los registros
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
        // ‚úÖ TU CONFIG DE FIREBASE
        const firebaseConfig = {
  apiKey: "AIzaSyCTV-miHc-sA9-n1MJjQEfwQSfyNvl9vG0",
  authDomain: "granja-los-campos-pos.firebaseapp.com",
  projectId: "granja-los-campos-pos",
  storageBucket: "granja-los-campos-pos.firebasestorage.app",
  messagingSenderId: "553361614502",
  appId: "1:553361614502:web:8192471c4d88bfe3e9b667",
  measurementId: "G-7SL48RPRSF"
};
        

        let db;

        // Inicializar Firebase
        function initDB() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                db = firebase.firestore();
                updateStatus('Firebase inicializado correctamente', 'success');
                return true;
            } catch (error) {
                updateStatus('Error al inicializar Firebase: ' + error.message, 'error');
                return false;
            }
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        function showData(elementId, data) {
            const dataDiv = document.getElementById(elementId);
            dataDiv.textContent = JSON.stringify(data, null, 2);
            dataDiv.style.display = 'block';
        }

        function hideData(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }

        // FUNCIONES CRUD (iguales a las de index.html)
        async function agregarRegistro(registro) {
            try {
                const docRef = await db.collection('registros').add({
                    ...registro,
                    fecha: new Date().toISOString()
                });
                return { success: true, id: docRef.id };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function obtenerRegistro(id) {
            try {
                const doc = await db.collection('registros').doc(id).get();
                if (doc.exists) {
                    return { success: true, data: { id: doc.id, ...doc.data() } };
                } else {
                    return { success: false, error: 'Registro no encontrado' };
                }
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function obtenerTodos() {
            try {
                const querySnapshot = await db.collection('registros').get();
                const registros = [];
                querySnapshot.forEach((doc) => {
                    registros.push({ id: doc.id, ...doc.data() });
                });
                return { success: true, data: registros };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function actualizarRegistro(id, datos) {
            try {
                await db.collection('registros').doc(id).update(datos);
                return { success: true };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function eliminarRegistro(id) {
            try {
                await db.collection('registros').doc(id).delete();
                return { success: true };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        async function limpiarStore() {
            try {
                const querySnapshot = await db.collection('registros').get();
                const batch = db.batch();

                querySnapshot.forEach((doc) => {
                    batch.delete(doc.ref);
                });

                await batch.commit();
                return { success: true };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        // FUNCIONES DE PRUEBA
        async function testAgregarRegistro() {
            updateStatus('Agregando registro...', 'info');
            hideData('todos-data');
            hideData('registro-data');

            if (!db) {
                updateStatus('Firebase no inicializado', 'error');
                return;
            }

            const tipo = document.getElementById('tipo').value;
            const descripcion = document.getElementById('descripcion').value;
            const cantidad = parseFloat(document.getElementById('cantidad').value);
            const precio = parseFloat(document.getElementById('precio').value);

            if (!descripcion || isNaN(cantidad) || isNaN(precio)) {
                updateStatus('Por favor completa todos los campos', 'error');
                return;
            }

            const registro = { tipo, descripcion, cantidad, precio };
            const result = await agregarRegistro(registro);

            if (result.success) {
                updateStatus('‚úÖ Registro agregado correctamente (ID: ' + result.id + ')', 'success');
                // Limpiar formulario
                document.getElementById('descripcion').value = '';
                document.getElementById('cantidad').value = '';
                document.getElementById('precio').value = '';
            } else {
                updateStatus('‚ùå Error al agregar: ' + result.error, 'error');
            }
        }

        async function testObtenerTodos() {
            updateStatus('Obteniendo todos los registros...', 'info');
            hideData('registro-data');

            if (!db) {
                updateStatus('Firebase no inicializado', 'error');
                return;
            }

            const result = await obtenerTodos();

            if (result.success) {
                updateStatus('‚úÖ Registros obtenidos (' + result.data.length + ')', 'success');
                showData('todos-data', result.data);
            } else {
                updateStatus('‚ùå Error al obtener: ' + result.error, 'error');
            }
        }

        async function testObtenerRegistro() {
            const id = document.getElementById('buscar-id').value.trim();
            if (!id) {
                updateStatus('Ingresa un ID v√°lido', 'error');
                return;
            }

            updateStatus('Buscando registro...', 'info');
            hideData('todos-data');

            if (!db) {
                updateStatus('Firebase no inicializado', 'error');
                return;
            }

            const result = await obtenerRegistro(id);

            if (result.success) {
                updateStatus('‚úÖ Registro encontrado', 'success');
                showData('registro-data', result.data);
            } else {
                updateStatus('‚ùå Error: ' + result.error, 'error');
            }
        }

        async function testActualizarRegistro() {
            const id = document.getElementById('update-id').value.trim();
            const descripcion = document.getElementById('update-descripcion').value.trim();

            if (!id || !descripcion) {
                updateStatus('Completa ID y nueva descripci√≥n', 'error');
                return;
            }

            updateStatus('Actualizando registro...', 'info');

            if (!db) {
                updateStatus('Firebase no inicializado', 'error');
                return;
            }

            const result = await actualizarRegistro(id, { descripcion });

            if (result.success) {
                updateStatus('‚úÖ Registro actualizado', 'success');
            } else {
                updateStatus('‚ùå Error al actualizar: ' + result.error, 'error');
            }
        }

        async function testEliminarRegistro() {
            const id = document.getElementById('delete-id').value.trim();
            if (!id) {
                updateStatus('Ingresa un ID v√°lido', 'error');
                return;
            }

            if (!confirm('¬øEst√°s seguro de eliminar este registro?')) {
                return;
            }

            updateStatus('Eliminando registro...', 'info');

            if (!db) {
                updateStatus('Firebase no inicializado', 'error');
                return;
            }

            const result = await eliminarRegistro(id);

            if (result.success) {
                updateStatus('‚úÖ Registro eliminado', 'success');
            } else {
                updateStatus('‚ùå Error al eliminar: ' + result.error, 'error');
            }
        }

        async function testLimpiarStore() {
            if (!confirm('¬øEst√°s seguro de eliminar TODOS los registros? Esta acci√≥n no se puede deshacer.')) {
                return;
            }

            updateStatus('Limpiando todos los registros...', 'info');

            if (!db) {
                updateStatus('Firebase no inicializado', 'error');
                return;
            }

            const result = await limpiarStore();

            if (result.success) {
                updateStatus('‚úÖ Todos los registros eliminados', 'success');
                hideData('todos-data');
                hideData('registro-data');
            } else {
                updateStatus('‚ùå Error al limpiar: ' + result.error, 'error');
            }
        }

        // Inicializar
        initDB();
    </script>
</body>
</html>